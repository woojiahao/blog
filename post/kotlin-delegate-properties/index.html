<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=theme-color content="dark"><title>Applications of Kotlin's delegate properties | jiahao.blog</title>
<meta property="og:site_name" content="jiahao.blog"><meta property="og:title" content="Applications of Kotlin's delegate properties | jiahao.blog"><meta itemprop=name content="Applications of Kotlin's delegate properties | jiahao.blog"><meta name=twitter:title content="Applications of Kotlin's delegate properties | jiahao.blog"><meta name=application-name content="Applications of Kotlin's delegate properties | jiahao.blog"><meta name=twitter:card content="summary"><meta name=description content="Exploring delegate properties while trying to improve the usability of kMD2PDF - a simple markdown to PDF converter"><meta name=twitter:description content="Exploring delegate properties while trying to improve the usability of kMD2PDF - a simple markdown to PDF converter "><meta itemprop=description content=" Exploring delegate properties while trying to improve the usability of kMD2PDF - a simple markdown to PDF converter "><meta property="og:description" content=" Exploring delegate properties while trying to improve the usability of kMD2PDF - a simple markdown to PDF converter "><meta property="og:type" content="article"><meta property="article:publisher" content="Jia Hao (jiƒÅh√°o)"><meta property="og:article:published_time" content=2019-07-13T00:00:00Z><meta property="article:published_time" content=2019-07-13T00:00:00Z><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Applications of Kotlin's delegate properties","author":{"@type":"Person","name":"Jia Hao (jiƒÅh√°o)"},"datePublished":"2019-07-13","description":"Exploring delegate properties while trying to improve the usability of kMD2PDF - a simple markdown to PDF converter","wordCount":1465,"mainEntityOfPage":"True","dateModified":"2019-07-13","publisher":{"@type":"Organization","name":"Jia Hao (jiƒÅh√°o)","logo":{"@type":"imageObject","url":"https:\/\/blog.woojiahao.com\/favicon.ico"}}}</script><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=stylesheet href=/sass/main.min.ab99ff095f832511e24ffb2fba2b51ad473b2f7e9301d674eba2c6c3a6e8bd81.css></head><script>(function(){const e="ThemeColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="ThemeColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.userColorScheme="dark":document.documentElement.dataset.userColorScheme="light"})()</script><body class=dark><nav class=navbar><div class=container><div class=flex><div><a class=brand href=/><span class=emoji>‚òÉÔ∏è
</span>jiahao.blog</a></div><div class=flex><a href=/articles/>Articles</a>
<button id=dark-mode-button><svg class="light" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M30.312.776C32 19 20 32 .776 30.312c8.199 7.717 21.091 7.588 29.107-.429C37.9 21.867 38.03 8.975 30.312.776z"/><path d="M30.705 15.915a1.163 1.163.0 101.643 1.641 1.163 1.163.0 00-1.643-1.641zm-16.022 14.38a1.74 1.74.0 000 2.465 1.742 1.742.0 100-2.465zm13.968-2.147a2.904 2.904.0 01-4.108.0 2.902 2.902.0 010-4.107 2.902 2.902.0 014.108.0 2.902 2.902.0 010 4.107z" fill="#ffcc4d"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg><svg class="dark" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" focusable="false" width="1em" height="1em" style="-ms-transform:rotate(360deg);-webkit-transform:rotate(360deg);transform:rotate(360deg)" viewBox="0 0 36 36"><path fill="#ffd983" d="M16 2s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2V2zm18 14s2 0 2 2-2 2-2 2h-2s-2 0-2-2 2-2 2-2h2zM4 16s2 0 2 2-2 2-2 2H2s-2 0-2-2 2-2 2-2h2zm5.121-8.707s1.414 1.414.0 2.828-2.828.0-2.828.0L4.878 8.708s-1.414-1.414.0-2.829c1.415-1.414 2.829.0 2.829.0l1.414 1.414zm21 21s1.414 1.414.0 2.828-2.828.0-2.828.0l-1.414-1.414s-1.414-1.414.0-2.828 2.828.0 2.828.0l1.414 1.414zm-.413-18.172s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zm-21 21s-1.414 1.414-2.828.0.0-2.828.0-2.828l1.414-1.414s1.414-1.414 2.828.0.0 2.828.0 2.828l-1.414 1.414zM16 32s0-2 2-2 2 2 2 2v2s0 2-2 2-2-2-2-2v-2z"/><circle fill="#ffd983" cx="18" cy="18" r="10"/><rect x="0" y="0" width="36" height="36" fill="rgba(0, 0, 0, 0)"/></svg></button></div></div></div></nav><main><div class=container><article><header class=article-header><div class=thumb><div><h1>Applications of Kotlin's delegate properties</h1><div class=post-meta><div>By Jia Hao (jiƒÅh√°o) | <time>July 13, 2019</time>
| 7 minutes</div><div class=tags><a href=/tags/kotlin/>Kotlin</a>
<a href=/tags/tutorial/>Tutorial</a>
<a href=/tags/guide/>Guide</a>
<a href=/tags/delegates/>Delegates</a>
<a href=/tags/kmd2pdf/>KMD2PDF</a></div></div></div></div></header></article><div class=article-post><h2 id=announcement-time><a href=#announcement-time class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>
</a>Announcement time!</h2><p>After a long hiatus from kMD2PDF, I revved up my engines and began to work on my latest planned feature for the
project&mldr;</p><p><strong>YAML support!</strong></p><p>Yes, now YAML is in the works and you can now control basic attributes of your exported document using only
<a href=https://jekyllrb.com/docs/front-matter/>front matter YAML.</a></p><p>This is an incredibly big milestone as this allows anyone to quickly customise their document without having to write a
single line of Kotlin, and with another planned release to create a GUI exporter for markdown documents, this would
greatly streamline users&rsquo; experience.</p><h2 id=okay-so-what-are-delegate-properties><a href=#okay-so-what-are-delegate-properties class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>
</a>Okay, so what are delegate properties?</h2><p>kMD2PDF introduces a theming engine where you are able to change the entire color scheme of an exported document just by
specifying an attribute in code as such</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>val</span> <span class=py>converter</span> <span class=p>=</span> <span class=n>markdownConverter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>settings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>theme</span> <span class=p>=</span> <span class=nc>Settings</span><span class=p>.</span><span class=nc>Theme</span><span class=p>.</span><span class=n>DARK</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>  
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=design-considerations><a href=#design-considerations class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>
</a>Design considerations</h3><p>Before building this system, we have to make several consideration</p><ol><li>How do we specify that certain attributes have different configurations depending on the theme?</li><li>How do we allow changes to the theme propagate to each element such that the changes are reflected during the
document creation?</li></ol><h4 id=using-singletons><a href=#using-singletons class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>
</a>Using singletons</h4><p>The second inquiry is rather easy to answer, so we will tackle that issue first - we can store the <code>Settings</code> as
<a href=https://en.wikipedia.org/wiki/Singleton_pattern>singleton</a>, since the state of a singleton is unique and static, as
long as the settings are configured before the document is created, then the settings will be chosen during runtime and
have the exported document reflect the changes.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>object</span> <span class=nc>Settings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>var</span> <span class=py>font</span> <span class=p>=</span> <span class=n>FontFamily</span><span class=p>(</span><span class=s2>&#34;sans-serif&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>get</span><span class=p>()</span> <span class=p>=</span> <span class=k>field</span><span class=p>.</span><span class=n>clone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>inline</span> <span class=k>fun</span> <span class=nf>settings</span><span class=p>(</span><span class=n>configuration</span><span class=p>:</span> <span class=nc>Settings</span><span class=p>.()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)</span> <span class=p>=</span> <span class=nc>Settings</span><span class=p>.</span><span class=n>apply</span><span class=p>(</span><span class=n>configuration</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Kotlin comes with a language construct to create singletons easily - <code>object</code> keyword (read more
<a href=https://kotlinlang.org/docs/reference/object-declarations.html#object-declarations>here</a>).</p><p>This creates everything we need in a singleton but reduces all the boiler plate that would be involved with creating
the singleton, unlike other languages like <a href=https://www.geeksforgeeks.org/singleton-class-java/>Java.</a></p><p>When we update the <code>Settings</code> singleton, the changes will reflect with the exported document since the document style is
lazily generated only up till the latest minute before it gets exported.</p><h4 id=multi-value-properties><a href=#multi-value-properties class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>
</a>Multi-value properties</h4><p>Now to tackle the hard question, how do we store multiple values in Kotlin? Ideally, what we would want with this system
is to have a single variable and have that variable store both the dark theme and light theme setting. That is, if we
had a single variable <code>textColor</code>, we would want to be able to store both the light theme and dark theme settings inside
this variable. Depending on the current <code>Settings.theme</code> configuration at the time where the stylesheet has to be
generated, the <code>textColor</code> variable would return either the configuration for <code>DARK</code> theme or <code>LIGHT</code> theme.</p><p>Traditionally, we would approach this issue using a class to store the information and have that be the end of things -
and this was indeed the approach I ended up employing due to certain limitations in that design which I&rsquo;ll discuss.</p><p>However, in Kotlin, there exists a language construct called
<a href=https://kotlinlang.org/docs/reference/delegated-properties.html>delegated properties</a> where you are able to call an
object constructor to initialise a variable and provide it with a base of data. Subsequent times accessing this variable
masks the object constructor and will only allow you to access the data type specified by the delegated property. You
can think of a delegated object as an object that defaults all variable references to the given <code>getValue</code> and
<code>setValue</code> attributes. This effectively means that once you&rsquo;ve delegated a property, you are no longer entitled to
modifying the object that created the delegate.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>import</span> <span class=nn>kotlin.reflect.*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>DelegateExample</span><span class=p>(</span><span class=k>private</span> <span class=k>var</span> <span class=py>internalValue</span> <span class=p>=</span> <span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>operator</span> <span class=k>fun</span> <span class=nf>getValue</span><span class=p>(</span><span class=n>thisRef</span><span class=p>:</span> <span class=n>Any</span><span class=p>?,</span> <span class=k>property</span><span class=p>:</span> <span class=n>KProperty</span><span class=p>&lt;*&gt;)</span> 
</span></span><span class=line><span class=cl>    <span class=p>=</span> <span class=s2>&#34;Internal value is </span><span class=si>${internalValue}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>operator</span> <span class=k>fun</span> <span class=nf>setValue</span><span class=p>(</span><span class=n>thisRef</span><span class=p>:</span> <span class=n>Any</span><span class=p>?,</span> <span class=k>property</span><span class=p>:</span> <span class=n>KProperty</span><span class=p>&lt;*&gt;,</span> <span class=k>value</span><span class=p>:</span> <span class=n>Int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>internalValue</span> <span class=o>+=</span> <span class=k>value</span><span class=p>.</span><span class=n>toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In the example above, we have created a delegated property that when referenced as a variable (get), will return a
string. But when called with an assignment operator (set) will only accept <code>Int</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>var</span> <span class=py>value</span> <span class=k>by</span> <span class=n>DelegateExample</span><span class=p>()</span>  <span class=c1>// internalValue = &#34;&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>println</span><span class=p>(</span><span class=k>value</span><span class=p>)</span>                  <span class=c1>// Internal value is 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>value</span> <span class=p>=</span> <span class=m>10</span>                      <span class=c1>// internalValue = &#34;10&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>println</span><span class=p>(</span><span class=k>value</span><span class=p>)</span>                  <span class=c1>// Internal value is 10
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>value</span> <span class=p>=</span> <span class=m>5</span>                       <span class=c1>// internalValue = &#34;105&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>println</span><span class=p>(</span><span class=k>value</span><span class=p>)</span>                  <span class=c1>// Internal value is 105
</span></span></span></code></pre></td></tr></table></div></div><p>As you can see from, in order to instantiate a delegated property and use the features of <code>getValue</code> and <code>setValue</code>, we
have to set the variable with the <code>by</code> keyword. This way, when you have variable references, it will always call the
respective <code>setValue</code>/<code>getValue</code> methods.</p><p>Now that you&rsquo;ve had a crash course with delegated properties in Kotlin, can you think of how we can apply this concept
to our current problem? To recap, we already have established a singleton to manage the configuration across all
elements - and the configuration we are most interested in is the <code>theme</code> attribute which indicates which theme the
document will create. In that case, since the state is singular and shared across the entire program, we can create a
delegate property to hold the configuration of all the themes available, and when the time comes to generate the CSS for
the document, the delegated property is called and it will return the corresponding attribute for the specific theme
configured during the time of generation (since the document HTML/CSS are generated per call of
<code>MarkdownConverter#convert</code> as opposed to generating them all at once).</p><p>In that case, we can create the delegated property as such:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>CssProperty</span> <span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>var</span> <span class=py>light</span><span class=p>:</span> <span class=n>T</span><span class=p>?,</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>var</span> <span class=py>dark</span><span class=p>:</span> <span class=n>T</span><span class=p>?</span> <span class=p>=</span> <span class=n>light</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>var</span> <span class=py>fallback</span><span class=p>:</span> <span class=n>T</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>operator</span> <span class=k>fun</span> <span class=nf>getValue</span><span class=p>(</span><span class=n>thisRef</span><span class=p>:</span> <span class=n>Any</span><span class=p>?,</span> <span class=k>property</span><span class=p>:</span> <span class=n>KProperty</span><span class=p>&lt;*&gt;)</span> <span class=p>=</span>
</span></span><span class=line><span class=cl>    <span class=k>when</span><span class=p>(</span><span class=nc>Settings</span><span class=p>.</span><span class=n>theme</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>LIGHT</span> <span class=o>-&gt;</span> <span class=n>light</span>
</span></span><span class=line><span class=cl>      <span class=n>DARK</span> <span class=o>-&gt;</span> <span class=n>dark</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=o>?:</span> <span class=n>fallback</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>operator</span> <span class=k>fun</span> <span class=nf>setValue</span><span class=p>(</span><span class=n>thisRef</span><span class=p>:</span> <span class=n>Any</span><span class=p>?,</span> <span class=k>property</span><span class=p>:</span> <span class=n>KProperty</span><span class=p>&lt;*&gt;,</span> <span class=k>value</span><span class=p>:</span> <span class=n>T</span><span class=p>?)</span> <span class=p>=</span>
</span></span><span class=line><span class=cl>    <span class=k>when</span><span class=p>(</span><span class=nc>Settings</span><span class=p>.</span><span class=n>theme</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>LIGHT</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>light</span> <span class=p>=</span> <span class=k>value</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=n>DARK</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>dark</span> <span class=p>=</span> <span class=k>value</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This way, we can create a <code>CssProperty</code> to hold the configurations required for each theme (light/dark for now) and then
when the variables are accessed, they will return the corresponding value stored depending on the current theme
configured in the settings. The <code>fallback</code> property is a &ldquo;default&rdquo; for each <code>CssProperty</code> in the event where the <code>light</code>
or <code>dark</code> property are both set to null.</p><p>To use the <code>CssProperty</code> class, we will use the following syntax:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>var</span> <span class=py>textColor</span> <span class=k>by</span> <span class=n>CssProperty</span><span class=p>&lt;</span><span class=n>FontFamily</span><span class=p>?&gt;(</span><span class=n>c</span><span class=p>(</span><span class=s2>&#34;00&#34;</span><span class=p>),</span> <span class=n>c</span><span class=p>(</span><span class=s2>&#34;fa&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>textColor</span><span class=p>)</span> <span class=c1>// Light theme text color -&gt; #000000
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nc>Settings</span><span class=p>.</span><span class=n>theme</span> <span class=p>=</span> <span class=nc>Settings</span><span class=p>.</span><span class=nc>Theme</span><span class=p>.</span><span class=n>DARK</span>
</span></span><span class=line><span class=cl><span class=n>print</span><span class=p>(</span><span class=n>textColor</span><span class=p>)</span> <span class=c1>// Dark theme text color  -&gt; #fafafa
</span></span></span></code></pre></td></tr></table></div></div><p>And this provides us with such a convenient interface to modify the values of the configured properties and to quickly
change the theme settings for each element on a whim.</p><h2 id=roadblocks-><a href=#roadblocks- class=anchor><svg class="icon" aria-hidden="true" focusable="false" height="16" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>
</a>Roadblocks üò¢</h2><p>However, when attempting to create the YAML feature, I had noticed a huge flaw in the delegate property system used for
configuring the style components. Since the YAML formatting had to be rendered during runtime and as such, the YAML had
to modify the existing style which while possible using the Singleton pattern, certain components like relying on a
fallback would not be able to register the changes made. Therefore, I had to revert to using a simple class to house the
CSS properties of an element and convert the Settings singleton to be a regular object that has to be passed to each
element for the configuration to take place.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>CssProperty</span><span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;(</span>
</span></span><span class=line><span class=cl>  <span class=k>val</span> <span class=py>theme</span><span class=p>:</span> <span class=nc>Settings</span><span class=p>.</span><span class=n>Theme</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>var</span> <span class=py>light</span><span class=p>:</span> <span class=n>T</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>var</span> <span class=py>dark</span><span class=p>:</span> <span class=n>T</span><span class=p>?</span> <span class=p>=</span> <span class=n>light</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>  <span class=k>private</span> <span class=k>var</span> <span class=py>fallback</span><span class=p>:</span> <span class=n>T</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>  <span class=k>var</span> <span class=py>value</span><span class=p>:</span> <span class=n>T</span><span class=p>?</span>
</span></span><span class=line><span class=cl>    <span class=k>get</span><span class=p>()</span> <span class=p>=</span> <span class=k>when</span><span class=p>(</span><span class=n>theme</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>LIGHT</span> <span class=o>-&gt;</span> <span class=n>light</span>
</span></span><span class=line><span class=cl>      <span class=n>DARK</span> <span class=o>-&gt;</span> <span class=n>dark</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=o>?:</span> <span class=n>fallback</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>set</span><span class=p>(</span><span class=n>input</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>light</span> <span class=p>=</span> <span class=n>input</span>
</span></span><span class=line><span class=cl>      <span class=n>dark</span> <span class=p>=</span> <span class=n>input</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Then in order for the converter to apply the changes of the YAML to the document being generated, we iterate over every
element within the style and apply the changes accordingly.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>fun</span> <span class=p>&lt;</span><span class=nc>T</span><span class=p>&gt;</span> <span class=nf>List</span><span class=p>&lt;</span><span class=n>Element</span><span class=p>&gt;.</span><span class=n>updateStyles</span><span class=p>(</span><span class=n>input</span><span class=p>:</span> <span class=n>T</span><span class=p>?,</span> <span class=n>update</span><span class=p>:</span> <span class=nc>Element</span><span class=p>.(</span><span class=n>T</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>input</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span> <span class=n>forEach</span> <span class=p>{</span> <span class=n>e</span> <span class=o>-&gt;</span> <span class=n>e</span><span class=p>.</span><span class=n>update</span><span class=p>(</span><span class=k>it</span><span class=p>)</span>  <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The lesson learnt here is that while a structure might look good on paper and work for a specific use case, this might
not always be the case and this can result in rewriting of the codebase. I was lucky that the codebase was one that I
was very familiar with and I could afford the rewrite to get this new feature up and running. However, I would not
always be so lucky and might encounter a codebase that might take too long to rewrite.</p></div></div><div class=container><nav class="flex container suggested"><a rel=prev href=/post/porting-flexmark/ title="Previous post (older)"><span>Previous</span>
Porting to FlexMark
</a><a rel=next href=/post/heroku-kotlin-discord-bot/ title="Next post (newer)"><span>Next</span>
Heroku x Docker x Discord bot x Kotlin</a></nav></div><div class=container><div class=disqus-container></div><script>window.addEventListener("onColorSchemeChange",e=>{DISQUS&&DISQUS.reset({reload:!0})})</script></div></main></main><footer class="footer flex"><section class=container><nav class=footer-links><a href=https://woojiahao.com>About Me</a>
<a href=/index.xml>RSS</a></nav></section><script defer src=/ts/features.706a523ba43e6d0427c7fdf2b9d05dbd0920d3f12942b453690b495cb2522743.js data-enable-footnotes=true></script></footer></body></html>